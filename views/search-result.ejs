<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("partials/meta.ejs") %>
    <title>RecipEasy: Results</title>
  </head>
  <body>
    <div class="container search-results">
      <%- include('partials/header-nav.ejs') %>
      <main>
        <% if (typeof(count)=="undefined" ){ %>
          <h2>Cannot connect to the server.</h2>
          <h3>Please contact ChefDevs team. Sorry for the inconvenience.</h3>
          <% } else{  %>
        <form action="search-results" method="get">
          <div class="labelwrapper-search">
            <div class=""></div>
            <div class="fieldwrapper-search">
              <label for="search_keywords" >Ingradients</label>
              <input
                type="text"
                id="search_keywords"
                name="search_keywords"
                placeholder="Ingredients"
                value="<%= q %> "
              />
            </div>
            <div>
              <input type="submit" Value="Filter Search" />
            </div>
          </div>
          <div class="labelwrapper-search">
            <div class="fieldwrapper-search">
              <label for="cuisineType"> Cuisine Type </label>
              <select id="select_cuisine" name="cuisineType">
                <option value="">___</option>
              </select>
            </div>
            <div class="fieldwrapper-search">
              <label for="mealType"> Meal Type </label>
              <select id="select_meal" name="mealType">
                <option value="">___</option>
              </select>
            </div>
            <div class="fieldwrapper-search">
              <label for="healthLabel"> Health Label</label>
              <select id="select_healthLabel" name="healthLabel" multiple  style="height:100px;">
                <option value="">___</option>
              </select>
            </div>
          </div>
        </form>
  
        <div class="recipe-result">
          <h3> <%
            if (typeof(cuisineSelected) != "undefined" && cuisineSelected != "") {
            %>
              Cuisine Type: <%= cuisineSelected %>;
            <% }
            if (typeof(mealSelected) != "undefined" && mealSelected != "") {
            %>
              Meal Type: <%= mealSelected %> <br/>
            <% } 
            if (typeof(healthSelected) != "undefined" && healthSelected[0] != "") {
            %>
              Health Label: <%= healthSelected %> 
            <% } %>
          </h3>
          <% 
            var totalHits=0; 
            if (count != 0){
              if (count < to){ 
                totalHits=count; 
              } else { 
                totalHits=to; 
              } 
          %> 
          <h2>Showing results for: <%= q %></h2>

          <div class="recipe-grid">
          <%
            for (let index=0; index < totalHits; index++) {
          %>
              <div class="recipe-card">
                <img src="<%= hits[index].recipe.image %>" alt="recipe photo" />
                <div>
                  <p><b> <%= hits[index].recipe.label %> </b></p>
                  <p>Cuisine Type: <%= hits[index].recipe.cuisineType %> <br />
                    Meal Type: <%= hits[index].recipe.mealType %> <br />
                    Source:
                    <a href="<%= hits[index].recipe.url %>" target="_blank">
                      <%= hits[0].recipe.source %>
                    </a>
                  </p>
                </div>
              </div>
          <% }%>
          </div>
          <% }else{ %>
            <h2> Nothing found for: <%= q %> </h2>
          <% } } %>
        </div>
      </main>
      <%- include("partials/footer.ejs") %>
    </div>
  </body>
  <script>
    const cuisineTypeArr = ["American", "Asian",	"British",	"Caribbean",	"Central Europe",	"Chinese",	"Eastern Europe",	"French",	"Indian",	"Italian",	
    "Japanese",	"Kosher",	"Mediterranean",	"Mexican",	"Middle Eastern",	"Nordic",	"South American",	"South East Asian"];
    cuisineTypeArr.forEach((cuisineType) => {
    let opt = document.createElement("option");
    opt.value = cuisineType;
    opt.text = cuisineType;
    select_cuisine.appendChild(opt);
    });

    const mealTypeArr = [	"Breakfast", "Brunch",	"Lunch",	"Dinner",	"Snack", "Teatime"];
    mealTypeArr.forEach((mealType) => {
    let opt = document.createElement("option");
    opt.value = mealType;
    opt.text = mealType;
    select_meal.appendChild(opt);
    });

    const healthLabelArr = ["alcohol-free", "immuno-supportive", "celery-free", "crustacean-free", "dairy-free", "egg-free", "fish-free", "fodmap-free", "gluten-free", "keto-friendly", 
    "kidney-friendly", "kosher", "low-potassium", "lupine-free", "mustard-free", "low-fat-abs", "No-oil-added", "low-sugar", "paleo", "peanut-free", "pecatarian", "pork-free", 
    "red-meat-free", "sesame-free", "shellfish-free", "soy-free", "tree-nut-free", "vegan", "vegetarian", "Wheat-free"];
    healthLabelArr.forEach((healthLabel) => {
    let opt = document.createElement("option");
    opt.value = healthLabel;
    opt.text = healthLabel;
    select_healthLabel.appendChild(opt);
    });

  </script>
</html>
